Elasticsearch是用Java开发并且是当前最流行的开源的企业级搜索引擎。 能够达到实时搜索，稳定，可靠，快速，安装使用方便

### 1. Lucene(ES的基石)

Lucene可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库（框架）。但是想要使用Lucene，必须使用Java来作为开发语言并将其直接集成到你的应用 中，并且Lucene的配置及使用非常复杂，你需要深入了解检索的相关知识来理解它是如何工作的。

Lucene缺点：(以下问题ES都可以解决)

* 只能在Java项目中使用,并且要以jar包的方式直接集成项目中
* 使用非常复杂-创建索引和搜索索引代码繁杂 
* 不支持集群环境-索引数据不同步（不支持大型项目） 
* 索引数据如果太多就不行，索引库和应用所在同一个服务器,共同占用硬 盘.共用空间少

#### 1.1 全文检索

* 通过一个程序扫描文本中的每一个单词，针对单词建立索引，并保存该单 词在文本中的位置、以及出现的次数 
* 用户查询时，通过之前建立好的索引来查询，将索引中单词对应的文本位 置、出现的次数返回给用户，因为有了具体文本的位置，所以就可以将具体内容读取出来了 

#### 1.2倒排索引

![image-20220219112038262](C:\Users\steven\AppData\Roaming\Typora\typora-user-images\image-20220219112038262.png)



### 2. 与Solr对比

* 当单纯的对已有数据进行搜索时，Solr更快。
* 当实时建立索引时, Solr会产生io阻塞，查询性能较差, Elasticsearch具有明显的 优势。 
* Solr 利用 Zookeeper 进行分布式管理，而Elasticsearch 自身带有分布式协调 管理功能。
* Solr 支持更多格式的数据，比如JSON、XML、CSV，而 Elasticsearch 仅支持 json文件格式。
* Solr 在传统的搜索应用中表现好于 Elasticsearch，但在处理实时搜索应用时效率明显低于 Elasticsearch
* Solr 是传统搜索应用的有力解决方案，但 Elasticsearch更适用于新兴的实时搜索应用

### 3. 与传统关系型数据库对比

![image-20220219111832886](C:\Users\steven\AppData\Roaming\Typora\typora-user-images\image-20220219111832886.png)

### 4. 核心概念

#### 4.1  索引 index

一个索引就是一个拥有几分相似特征的文档的集合.类似于关系型数据库的的 数据库，索引名必须全部是小写字母

#### 4.2 Type

类型，类似于关系型数据库中的表，在新版本中已经弱化了这个概念，基本没有这个概念了

#### 4.3映射 mapping

映射用于定义一个文档

#### 4.4 字段field

类似于数据库的列

**字段类型**

每一个字段都应该有一个对应的类型，例如：Text、Keyword、Byte等

#### 4.5 文档 document

一个文档是一个可被索引的基础信息单元，类似一条记录。文档以json格式表示

#### 4.6 集群 Cluster

一个集群就是由一个或多个节点组织在一起，它们共同持有整个的数据，并一起提 供索引和搜索功能

* 脑裂：同一个集群中的不同节点，对于集群的状态有了不一样的理解
* 

#### 4.7  节点

一个节点是集群中的一个服务器，作为集群的一部分，它存储数据，参与集群的索 引和搜索功能

一个节点可以通过配置集群名称的方式来加入一个指定的集群。默认情况下，每 个节点都会被安排加入到一个叫做“elasticsearch”的集群中。这意味着，如果在网络中启动了若干个节点，并假定它们能够相互发现彼此，它们 将会自动地形成并加入到一个叫做“elasticsearch”的集群中。

在一个集群里，可以拥有任意多个节点。而且，如果当前网络中没有运行任何Elasticsearch节点，这时启动一个节点，会默认创建并加入一个叫做“elasticsearch”的集群。 

* 客户端节点：
  * 当主节点和数据节点配置都设置为false的时候，该节点只能处理路由请求，处理搜索，分发索引操作等，从本质上来说该客户节点表现为智能负载平衡器
  * 独立的客户端节点在一个比较大的集群中是非常有用的，他协调主节点和数据节 点，客户端节点加入集群可以得到集群的状态，根据集群的状态可以直接路由请求。 
* 数据节点：
  * 数据节点主要是存储索引数据的节点，主要对文档进行增删改查操作，聚合操作等。
  * 数据节点对cpu，内存，io要求较高， 在优化的时候需要监控数据节点的状态， 当资源不够的时候，需要在集群中添加新的节点。 
* 主节点 ：
  * 主资格节点的主要职责是和集群操作相关的内容，如创建或删除索引，跟踪哪些节 点是群集的一部分，并决定哪些分片分配给相关的节点
  * 稳定的主节点对集群的健康 是非常重要的，默认情况下任何一个集群中的节点都有可能被选为主节点
  * 索引数据 和搜索查询等操作会占用大量的cpu，内存，io资源，为了确保一个集群的稳定，分离 主节点和数据节点是一个比较好的选择
  * 

#### 4.8 分片

* 一个索引可以存储超出单个结点硬件限制的大量数据
* 为了解决这个问题，Elasticsearch提供了将索引划分成多份的能力，这些 份就叫做分片
* 当创建一个索引的时候，可以指定你想要的分片的数量 
* 每个分片本身也是一个功能完善并且独立的“索引”，这个“索引”可以 被放置到集群中的任何节点上
* 分片很重要，主要有两方面的原因 
  * 允许水平分割/扩展你的内容容量 
  * 允许在分片之上进行分布式的、并行的操作，进而提高性能/吞吐量
* 至于一个分片怎样分布，它的文档怎样聚合回搜索请求，是完全由 Elasticsearch管理的，对于作为用户来说，这些都是透明的 

#### 4.9 副本

在一个网络/云的环境里，失败随时都可能发生，在某个分片/节点不知怎 么的就处于离线状态，或者由于任何原因消失了，这种情况下，有一个故障转 移机制是非常有用并且是强烈推荐的。为此目的，Elasticsearch允许你创建分 片的一份或多份拷贝，这些拷贝叫做副本分片，或者直接叫副本 

副本之所以重要，有两个主要原因:

* 在分片/节点失败的情况下，提供了高可用性。 
* 扩展搜索量/吞吐量，因为搜索可以在所有的副本上并行运行 

索引创建之后，可以在任何时候动态地改变副本的数量，但是不能改变分片的数量

### 5. 乐观并发控制

ES新版本不使用version进行并发版本控制 if_seq_no=版本值 &if_primary_term=文档位置 

* `_seq_no`：文档版本号，作用同_version 

* `_primary_term`：文档所在位置 



